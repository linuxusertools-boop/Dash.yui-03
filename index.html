<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YUI 03 | DASHBOARD</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Orbitron:wght@400;700;900&display=swap');
        :root { --primary: #00f2ff; --bg: #010206; --border: rgba(255,255,255,0.1); --success: #00ffaa; --warning: #ffb300; }
        body { background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans'; overflow-x: hidden; margin:0; }
        .max-width { max-width: 800px; margin: 0 auto; padding: 20px; }
        .update-box { border: 1px solid var(--primary); padding: 30px; border-radius: 30px; background: rgba(0,242,255,0.03); margin: 30px 0; }
        .input-std { width: 100%; padding: 12px; margin-bottom: 15px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; border-radius: 10px; }
        .main-btn { padding: 15px; width: 100%; cursor: pointer; border: 1px solid var(--border); background: rgba(255,255,255,0.05); color: #fff; font-family: 'Orbitron'; font-size: 10px; border-radius: 15px; transition: 0.3s; }
        .main-btn:hover { background: rgba(255,255,255,0.1); }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: rgba(255,255,255,0.04); border-radius: 20px; border: 1px solid var(--border); margin-bottom: 15px; }
        .badge { font-size: 9px; padding: 3px 8px; border-radius: 5px; font-weight: bold; margin-left: 10px; text-transform: uppercase; }
        .bg-fix { background: var(--success); color: #000; }
        .bg-maint { background: #ff4444; color: #fff; }
        progress { width: 100%; height: 10px; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <main class="max-width">
        <div style="text-align:center; padding: 40px 0;">
            <h1 style="font-family:'Orbitron'; color:var(--primary); letter-spacing:5px;">YUI Â¤ 03</h1>
            <p style="font-size:10px; opacity:0.5; font-family:'Orbitron';">NEURAL CLOUD SYNC ACTIVE</p>
        </div>

        <div id="admin-panel" style="border: 1px solid var(--success); padding: 25px; border-radius: 25px; background: rgba(0,255,170,0.02); margin-bottom: 30px;">
            <h4 style="font-family:'Orbitron'; color:var(--success); margin-bottom:20px; font-size:12px;">DEPLOYMENT CONSOLE</h4>
            <select id="upType" class="input-std" onchange="toggleFile()">
                <option value="fix">FIX / NEW UPDATE</option>
                <option value="maint">MAINTENANCE MODE</option>
            </select>
            <input type="text" id="upDesc" class="input-std" placeholder="Update Description (e.g. Bug fixes in Neural Node)">
            <input type="file" id="upFile" class="input-std">
            <progress id="upProg" value="0" max="100" style="display:none;"></progress>
            <button id="btnPush" class="main-btn" style="background:var(--success); color:#000; border:none; font-weight:800;">PUSH TO PUBLIC STREAM</button>
        </div>

        <div class="update-box">
            <h3 style="font-family:'Orbitron'; color:var(--primary); text-align:center; margin-bottom:25px; letter-spacing:5px;">(ğ—¨ğ—£ğ——ğ—”ğ—§ğ—˜ ğ—™ğ—œğ—Ÿğ—˜)</h3>
            <div id="update-list">
                <p style="text-align:center; opacity:0.3; font-size:12px;">Connecting to Firebase Storage...</p>
            </div>
        </div>
    </main>

    <script type="module">
        // Import Firebase Modular
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

        // Konfigurasi Milikmu
        const firebaseConfig = {
            apiKey: "AIzaSyBrSQQw5iSgX5FeZlOOAsn6wZVdBTualc4",
            authDomain: "yui-system.firebaseapp.com",
            projectId: "yui-system",
            storageBucket: "yui-system.firebasestorage.app",
            messagingSenderId: "116127420074",
            appId: "1:116127420074:web:324b963d1fe2a2e0db0ad3",
            measurementId: "G-78GJCCMBVZ"
        };

        // Initialize
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const storage = getStorage(app);

        // Toggle File Input
        window.toggleFile = () => {
            const type = document.getElementById('upType').value;
            document.getElementById('upFile').style.display = (type === 'maint') ? 'none' : 'block';
        };

        // Push Update Function
        document.getElementById('btnPush').onclick = async () => {
            const type = document.getElementById('upType').value;
            const desc = document.getElementById('upDesc').value;
            const file = document.getElementById('upFile').files[0];
            const btn = document.getElementById('btnPush');
            const prog = document.getElementById('upProg');

            if(!desc) return alert("Isi deskripsi!");

            btn.disabled = true;
            btn.innerText = "PROCESSING...";

            try {
                let downloadURL = null;
                let fileName = "SYSTEM_MSG";

                if (type === 'fix' && file) {
                    fileName = file.name;
                    prog.style.display = "block";
                    const storageRef = sRef(storage, 'updates/' + file.name);
                    const uploadTask = uploadBytesResumable(storageRef, file);

                    await new Promise((resolve, reject) => {
                        uploadTask.on('state_changed', 
                            (snap) => { prog.value = (snap.bytesTransferred / snap.totalBytes) * 100; },
                            (err) => reject(err),
                            async () => {
                                downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                                resolve();
                            }
                        );
                    });
                }

                // Simpan ke Realtime Database
                const newListRef = push(ref(db, 'neural_updates'));
                await set(newListRef, {
                    type,
                    name: fileName,
                    desc,
                    url: downloadURL,
                    time: new Date().toLocaleString('id-ID')
                });

                alert("Deployed successfully!");
                location.reload();
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
                btn.disabled = false;
                btn.innerText = "PUSH TO PUBLIC STREAM";
            }
        };

        // Real-time Listener (User View)
        onValue(ref(db, 'neural_updates'), (snapshot) => {
            const container = document.getElementById('update-list');
            container.innerHTML = "";
            const data = snapshot.val();

            if (!data) {
                container.innerHTML = "<p style='text-align:center; opacity:0.3;'>No neural updates found.</p>";
                return;
            }

            Object.values(data).reverse().forEach(up => {
                const isMaint = up.type === 'maint';
                container.innerHTML += `
                    <div class="file-item">
                        <div>
                            <div style="font-family:'Orbitron'; font-size:13px; color:#fff;">
                                ${up.name} <span class="badge ${isMaint ? 'bg-maint' : 'bg-fix'}">${up.type}</span>
                            </div>
                            <div style="font-size:11px; color:#aaa; margin-top:5px;">${up.desc}</div>
                            <div style="font-size:9px; color:var(--primary); margin-top:5px; font-family:'Orbitron';">${up.time}</div>
                        </div>
                        ${up.url ? `<a href="${up.url}" target="_blank" class="main-btn" style="width:auto; padding:10px 20px; background:var(--primary); color:#000; border:none;">GET</a>` : ''}
                    </div>
                `;
            });
        });
    </script>
</body>
</html>
